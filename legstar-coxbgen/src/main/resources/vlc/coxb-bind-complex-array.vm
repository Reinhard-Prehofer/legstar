#**
Complex array binding class Velocity Template.
@author Fady
@version 1.1.1
*#
## ==================================================================
## Complex array (Wrapper) element binding code
##
#parse("vlc/coxb-bind-common-imports.vm")

package $binding-type-package;

import com.legstar.coxb.ICobolComplexBinding;
import com.legstar.coxb.common.CArrayComplexBinding;
#foreach($importType in $importTypes)
import ${importType};
#end
import com.legstar.coxb.host.HostException;
import java.util.List;
import java.util.ArrayList;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import ${jaxb-package}.$helper.getItemJaxbTypeName($binding);

 /**
 * LegStar Binding for Complex Array (Wrapper) element:
 *   $binding.jaxbType.
 * 
 * Represents an array of complex (record) elements. A complex array maps to
 * a cobol OCCURS of group items and to java Lists.
 * 
 * This class was generated by ${generatorName}.
 * Generated on $formattedDate
 */

public class $binding-class-name 
             extends CArrayComplexBinding {

    /** Java object to which this cobol complex array element is bound. */
    private $helper.getComplexArrayJaxbTypeName($binding) mJaxbObject;
    
    /** Logger. */
    private static final Log LOG
        = LogFactory.getLog(${binding-class-name}.class);

    /**
     * Constructor for an array of Complex elements.
     * 
     * @param bindingName the identifier for this binding
     * @param jaxbName name of field in parent JAXB object
     * @param parentBinding a reference to the parent binding
     * @param complexItemBinding a binding element for array items
     */
    public $binding-class-name(
            final String bindingName,
            final String jaxbName,
            final ICobolComplexBinding parentBinding,
            final ICobolComplexBinding complexItemBinding) {
        
        super(bindingName, jaxbName, ${helper.getItemJaxbTypeName($binding)}.class, null, parentBinding, complexItemBinding);
        setMinOccurs(${binding.getMinOccurs()});
        setMaxOccurs(${binding.getMaxOccurs()});
#if(${helper.isEmpty("${binding.getDependingOn()}")} == false)
        setDependingOn("${binding.getDependingOn()}");
#end
    }

    /** {@inheritDoc} */
    public final void createJaxbObject() throws HostException {
        mJaxbObject = new Array$helper.getComplexArrayJaxbTypeName($binding)();
    }

    /** {@inheritDoc} */
    public final void setItemValue(
        final int index) throws HostException {
         /* Make sure there is an associated JAXB object*/
        if (mJaxbObject == null) {
            createJaxbObject();
        }
        /* The Jaxb list might have less items than expected by the binding.
         * In this case, we fill the binding with empty items. */
        if (index < mJaxbObject.size()) {
            if (LOG.isDebugEnabled()) {
                LOG.debug("Getting value from item " +  index
                        + " of JAXB property "
                        + "$helper.getComplexArrayJaxbTypeName($binding)"
                        + " value=" + mJaxbObject.get(index));
            }
            getComplexItemBinding().setObjectValue(mJaxbObject.get(index));
        } else {
            if (LOG.isDebugEnabled()) {
                LOG.debug("Initializing item " +  index);
            }
            getComplexItemBinding().setObjectValue(null);
        }
    }

    /** {@inheritDoc} */
    @SuppressWarnings("unchecked")
    public final void addJaxbPropertyValue(
        final int index) throws HostException {
         /* Make sure there is an associated JAXB object*/
        if (mJaxbObject == null) {
            throw new HostException(
                    "Binded object not initialized for " + getBindingName());
        }
        mJaxbObject.add((${helper.getItemJaxbTypeName($binding)}) getComplexItemBinding().
        		getObjectValue(${helper.getItemJaxbTypeName($binding)}.class));
    }
 
    /** {@inheritDoc} */
    public final List < ? > getObjectList() {
        return mJaxbObject;
    }

    /** {@inheritDoc} */
    @SuppressWarnings("unchecked")
    public final void setObjectList(
            final List list) {
        mJaxbObject = list;
    }
    
    /** {@inheritDoc} */
    public final Object getObjectValue(
            final Class < ? > type) throws HostException {
        if (type.equals(${helper.getItemJaxbTypeName($binding)}.class)) {
            return mJaxbObject;
        } else {
            throw new HostException("Attempt to get binding " + getBindingName()
                    + " as an incompatible type " + type);
        }
    }

    /** {@inheritDoc} */
     @SuppressWarnings("unchecked")
    public final void setObjectValue(final Object value) throws HostException {
        if (value == null) {
            mJaxbObject = null;
            return;
        }
        if (value instanceof List) {
            if (((List < ? >) value).size() == 0) {
                mJaxbObject = new Array${helper.getComplexArrayJaxbTypeName($binding)}();
                return;
            }
            /* We assume all items will have the same type as the first one.
             * The unchecked cast might break at runtime. */
            Object item = ((List < ? >) value).get(0);
            if (item.getClass().equals(${helper.getItemJaxbTypeName($binding)}.class)) {
                mJaxbObject = (${helper.getComplexArrayJaxbTypeName($binding)}) value;
                return;
            }
        }
        throw new HostException("Attempt to set binding " + getBindingName()
                + " from an incompatible value " + value);
    }

    /** {@inheritDoc} */
    public final boolean isSet() {
        return (mJaxbObject != null);
    }

    /**
     * @return the bound JAXB object
     * @throws HostException if bound JAXB object cannot be retrieved
     */
    @SuppressWarnings("unchecked")
    public final ${helper.getComplexArrayJaxbTypeName($binding)} get${helper.getItemJaxbTypeName($binding)}() throws HostException {
        return (${helper.getComplexArrayJaxbTypeName($binding)}) getObjectValue(${helper.getItemJaxbTypeName($binding)}.class);
    }
    
}
