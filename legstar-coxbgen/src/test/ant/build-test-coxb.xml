<?xml version="1.0" standalone="yes"?>
<!-- =================================================================================
     Iterates thru XML schemas and generates COXB binding classes for each. 
     This script assumes JAXB classes have already been generated for those
     schemas.
  -->
<project basedir="..\..\.." default="compileAllCOXB">
	
	<!-- ===========================================================  -->
	<!-- Setup environment
	  -->
	<target name="init">

		<!-- Target location for generated JAXB sources   -->
		<property name="jaxb.src.dir" value="${basedir}/src/test/java"/>
		<!-- Target location for generated JAXB binaries   -->
		<property name="jaxb.bin.dir" value="${basedir}/target/test-classes"/>
		<!-- Location of XML schemas  -->
	 	<property name="xsd.dir" value="${basedir}/../legstar-schemagen/src/test/schema" />
		<!-- The JAXB root object name. Binding is for a single complex
		     element. (Assuming all schemas have same root name here)   -->
	 	<property name="jaxb.root.name" value="DfhcommareaType" />
		<!-- Location of Legstar binaries   -->
		<property name="build.dir" value="${basedir}/target"/>
			
		<!-- Classpath setting -->
		<property name="maven.repo" value="C:\Documents and Settings\Fady\.m2\repository"/>
		<path id="classpath">
			<!-- JAXB-related Classpath  -->
		    <pathelement location="${maven.repo}\com\sun\xml\bind\jaxb-impl\2.1\jaxb-impl-2.1.jar"/>
		    <pathelement location="${maven.repo}\com\sun\xml\bind\jaxb-xjc\2.1\jaxb-xjc-2.1.jar"/>
		    <pathelement location="${maven.repo}\javax\activation\activation\1.1\activation-1.1.jar"/>
		    <pathelement location="${maven.repo}\javax\xml\bind\jaxb-api\2.1\jaxb-api-2.1.jar"/>
		    <pathelement location="${maven.repo}\javax\xml\bind\jsr173_api\1.0\jsr173_api-1.0.jar"/>
	  		<!--SAXON binaries -->
		    <pathelement location="${maven.repo}\net\sf\saxon\saxon\8.7\saxon-8.7.jar"/>
	  		<!--Legstar COXB runtime location -->
		    <pathelement location="${maven.repo}\com\legsem\legstar\legstar-coxbrt\1.0.1\legstar-coxbrt-1.0.1.jar"/>
	  		<!--Legstar common runtime location -->
		    <pathelement location="${maven.repo}\com\legsem\legstar\legstar-common\1.0.1\legstar-common-1.0.1.jar"/>
	  		<!--JAXB generated classes -->
	  		<pathelement location="${build.dir}/test-classes"/>
	  		<!--COXB Generator classes -->
	  		<pathelement location="${build.dir}/classes"/>
	  	</path>

		<!-- Generator ant task -->
		<taskdef name="coxbgen"
			classname="com.legstar.coxb.gen.CoxbBindingGenerator"
			classpathref="classpath"/>

		<!-- Ant-Contrib tasks. Needed for "foreach ", regex, switch, ...
		     (ant-contrib.jar must be in ant classpath) -->
	    <taskdef resource="net/sf/antcontrib/antcontrib.properties">
	    	<classpath>
			    <pathelement location="C:\Program Files\Apache\antcontrib\ant-contrib-1.0b2-bin\ant-contrib\lib\ant-contrib.jar"/>
	    	</classpath>
	    </taskdef>
		
	</target>

	<!-- ===========================================================  -->
	<!-- Generate COXB output for a each XML schema in a given folder
	  -->
	<target name="generateAllCOXB" depends="init">
		<foreach target="generateCOXB" param="xsd.file">
			<path>
				<fileset dir="${xsd.dir}" includes="*.xsd" excludes="clegtstc.cbl.xsd lsfileal.xsd lsfileac.xsd"/>
			</path>
		</foreach>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileal.xsd"
			JaxbRootObjectName="RequestParmsType"
			targetDir="${jaxb.src.dir}"
		/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileal.xsd"
			JaxbRootObjectName="ReplyDataType"
			targetDir="${jaxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="QueryDataType"
			targetDir="${jaxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="QueryLimitType"
			targetDir="${jaxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="ReplyStatusType"
			targetDir="${jaxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="ReplyDataType"
			targetDir="${jaxb.src.dir}"
			/>
		</target>
	
	<!-- ===========================================================  -->
	<!-- Compiles the generated binding classes
	  -->
	<target name="compileAllCOXB" depends="generateAllCOXB">
		 <javac srcdir="${jaxb.src.dir}"
		 	     includes="**/*.java"
	             excludes="local/**"
		         destdir="${jaxb.bin.dir}"
		 	     classpathref="classpath"
		         fork="yes"
		 />
	</target>

	<!-- ===========================================================  -->
	<!-- Generate binding classes by reflecting on JAXB classes.
	  -->
	<target name="generateCOXB" depends="init">
	    <echo message="Generating binding classes for ${xsd.file}" />
		<coxbgen 
			XsdFile="${xsd.file}"
			JaxbRootObjectName="${jaxb.root.name}"
			targetDir="${jaxb.src.dir}"
		/>
	</target>

	
</project>
