<?xml version="1.0" standalone="yes"?>
<!-- =================================================================================
     Iterates thru XML schemas and generates COXB binding classes for each. 
     This script assumes JAXB classes have already been generated for those
     schemas.
  -->
<project basedir="..\..\.." default="compileAllCOXB">
	
	<!-- ===========================================================  -->
	<!-- Setup environment
	  -->
	<target name="init">

		<!-- Target location for generated COXB sources   -->
		<property name="coxb.src.dir" value="${basedir}/../legstar-coxbgen-cases/src/main/java"/>
		<!-- Target location for generated COXB binaries   -->
		<property name="coxb.bin.dir" value="${basedir}/../legstar-coxbgen-cases/target/classes"/>
		<!-- Location of XML schemas  -->
	 	<property name="xsd.dir" value="${basedir}/../legstar-schemagen/src/test/schema" />
		<!-- The JAXB root object name. Binding is for a single complex
		     element. (Assuming all schemas have same root name here)   -->
	 	<property name="jaxb.root.name" value="DfhcommareaType" />
		<!-- Location of LegStar binaries   -->
		<property name="build.dir" value="${basedir}/target"/>
			
		<!-- Classpath setting -->
		<property name="maven.repo" value="C:\Documents and Settings\Fady\.m2\repository"/>
		<path id="classpath">
			<!-- JAXB-related Classpath  -->
		    <pathelement location="${maven.repo}\javax\xml\bind\jaxb-api\2.1\jaxb-api-2.1.jar"/>
		    <pathelement location="${maven.repo}\javax\xml\bind\jsr173_api\1.0\jsr173_api-1.0.jar"/>
	  		<!--WS logging binaries -->
		    <pathelement location="${maven.repo}\commons-logging\commons-logging-api\1.0.4\commons-logging-api-1.0.4.jar"/>
			<!-- Velocity engine location  -->
		    <pathelement location="${maven.repo}/org/apache/velocity/velocity/1.5/velocity-1.5.jar"/>
		    <pathelement location="${maven.repo}/commons-collections/commons-collections/3.2/commons-collections-3.2.jar"/>
		    <pathelement location="${maven.repo}/commons-lang/commons-lang/2.3/commons-lang-2.3.jar"/>
	  		<!--LegStar General binding classes location -->
    		<pathelement location="${basedir}/../legstar-coxbapi/target/classes"/>
	  		<!--LegStar Code generation location -->
		    <pathelement location="${basedir}/../legstar-codegen/target/classes"/>
	  		<!--LegStar COXB runtime location -->
		    <pathelement location="${basedir}/../legstar-coxbrt/target/classes"/>
	  		<!--JAXB generated classes -->
	  		<pathelement location="${basedir}/../legstar-jaxbgen-cases/target/classes"/>
	  		<!--COXB Generator classes -->
	  		<pathelement location="${build.dir}/classes"/>
	  	</path>

		<!-- Generator ant task -->
		<taskdef name="coxbgen"
			classname="com.legstar.coxb.gen.CoxbBindingGenerator"
			classpathref="classpath"/>

		<!-- Ant-Contrib tasks. Needed for "foreach ", regex, switch, ...
		     (ant-contrib.jar must be in ant classpath) -->
	    <taskdef resource="net/sf/antcontrib/antcontrib.properties">
	    	<classpath>
			    <pathelement location="C:\Program Files\Apache\antcontrib\ant-contrib-1.0b2-bin\ant-contrib\lib\ant-contrib.jar"/>
	    	</classpath>
	    </taskdef>
		
	</target>

	<!-- ===========================================================  -->
	<!-- Generate COXB output for a each XML schema in a given folder
	  -->
	<target name="generateAllCOXB" depends="init">
		<mkdir dir="${coxb.bin.dir}"/>
		<foreach target="generateCOXB" param="xsd.file">
			<path>
				<fileset dir="${xsd.dir}" includes="*.xsd" excludes="clegtstc.cbl.xsd lsfileal.xsd lsfileac.xsd enumvar.xsd MSNSearch.xsd cultureinfo.xsd"/>
			</path>
		</foreach>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileal.xsd"
			JaxbRootObjectName="RequestParmsType"
			targetDir="${coxb.src.dir}"
		/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileal.xsd"
			JaxbRootObjectName="ReplyDataType"
			targetDir="${coxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="QueryDataType"
			targetDir="${coxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="QueryLimitType"
			targetDir="${coxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="ReplyStatusType"
			targetDir="${coxb.src.dir}"
			/>
		<coxbgen 
			XsdFile="${xsd.dir}/lsfileac.xsd"
			JaxbRootObjectName="ReplyDataType"
			targetDir="${coxb.src.dir}"
			/>
        <!--
        <coxbgen 
            XsdFile="${xsd.dir}/MSNSearch.xsd"
            JaxbRootObjectName="SearchRequestType"
            targetDir="${coxb.src.dir}"
            />
        <coxbgen 
            XsdFile="${xsd.dir}/MSNSearch.xsd"
            JaxbRootObjectName="SearchResponseType"
            targetDir="${coxb.src.dir}"
            />
        <coxbgen 
            XsdFile="${xsd.dir}/cultureinfo.xsd"
            JaxbRootObjectName="CultureInfoRequestType"
            targetDir="${coxb.src.dir}"
            />
        <coxbgen 
            XsdFile="${xsd.dir}/cultureinfo.xsd"
            JaxbRootObjectName="CultureInfoReplyType"
            targetDir="${coxb.src.dir}"
            />
		<coxbgen 
			XsdFile="${xsd.dir}/enumvar.xsd"
			JaxbRootObjectName="SearchRequestType"
			targetDir="${coxb.src.dir}"
			/>
		-->
		</target>
	
	<!-- ===========================================================  -->
	<!-- Compiles the generated binding classes
	  -->
	<target name="compileAllCOXB" depends="generateAllCOXB">
		 <javac srcdir="${coxb.src.dir}"
		 	     includes="**/*.java"
	             excludes="local/**"
		         destdir="${coxb.bin.dir}"
		 	     classpathref="classpath"
		         fork="yes"
		 />
	</target>

	<!-- ===========================================================  -->
	<!-- Generate binding classes by reflecting on JAXB classes.
	  -->
	<target name="generateCOXB" depends="init">
	    <echo message="Generating binding classes for ${xsd.file}" />
		<coxbgen 
			XsdFile="${xsd.file}"
			JaxbRootObjectName="${jaxb.root.name}"
			targetDir="${coxb.src.dir}"
		/>
	</target>

	
</project>
