##/////////////////////////////////////////////////////////////////////
##Jaxws Component Sun Jaxws XML Template.
##@author Fady
##@version 0.1
##/////////////////////////////////////////////////////////////////////
##
#set($warFile = "${warDir}/cixs-${jaxwsComponent.name}.war")
#set($wddFile = "${wddDir}/${jaxwsComponent.name}/web.xml")
## ==================================================================
## Macro will help make sure we process packages only once
## ==================================================================
#macro(addPackage $list, $newPackage)
#if (!$list.contains($newPackage))
#set($ret = $list.add($newPackage))
#end
#end
## ==================================================================
## Create a list of unique jaxb package names
## ==================================================================
#set($jaxbPackages = [])
#foreach ($cixsOperation in $jaxwsComponent.cixsOperations)
#foreach ($cixsStructure in $cixsOperation.getInput())
#set($newPackage = ${cixsStructure.jaxbPackageName})
#addPackage($jaxbPackages, $newPackage)
#end
#foreach ($cixsStructure in $cixsOperation.getOutput())
#set($newPackage = ${cixsStructure.jaxbPackageName})
#addPackage($jaxbPackages, $newPackage)
#end
#end
## ==================================================================
## Create a list of unique coxb (binding) package names
## ==================================================================
#set($coxbPackages = [])
#foreach ($cixsOperation in $jaxwsComponent.cixsOperations)
#foreach ($cixsStructure in $cixsOperation.getInput())
#set($newPackage = ${cixsStructure.coxbPackageName})
#addPackage($coxbPackages, $newPackage)
#end
#foreach ($cixsStructure in $cixsOperation.getOutput())
#set($newPackage = ${cixsStructure.coxbPackageName})
#addPackage($coxbPackages, $newPackage)
#end
#end
<?xml version="1.0" encoding="UTF-8"?>
<project basedir=".." default="create-war" name="build-war">
   <property environment="env"/>
   <property name="service" value="${jaxwsComponent.name}"/>
   <target name="clean">
      <delete file="${warFile}" includeEmptyDirs="true"
              quiet="true"/>
   </target>
   <target name="create-war" depends="clean">
      <war warfile="${warFile}"
           webxml="${wddFile}">
         <webinf dir="${wddDir}/${jaxwsComponent.name}"
                 includes="sun-jaxws.xml"/>
#foreach ($jaxbPackage in $jaxbPackages)
         <classes dir="${jaxbBinDir}">
            <include name="${jaxbPackage.replace(".","/")}/*.class"/>
         </classes>
#end
#foreach ($coxbPackage in $coxbPackages)
         <classes dir="${coxbBinDir}">
            <include name="${coxbPackage.replace(".","/")}/*.class"/>
         </classes>
#end
         <classes dir="${cixsBinDir}">
            <include name="**/${service}/**/*.class"/>
         </classes>
#if($cixsBinDir != $custBinDir)
         <classes dir="${custBinDir}">
            <include name="**/${service}/**/*.class"/>
         </classes>
#end
#foreach ($cixsOperation in $jaxwsComponent.cixsOperations)
         <classes dir="${propDir}">
            <include name="${cixsOperation.name}.properties"/>
         </classes>
#end
      </war>
   </target>
</project>