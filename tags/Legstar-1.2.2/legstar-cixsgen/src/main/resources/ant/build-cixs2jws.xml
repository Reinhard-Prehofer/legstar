<?xml version="1.0" encoding="UTF-8"?>
<!-- =================================================================================
     Generate a mainframe proxy to a Web Service.
     Artifacts can be used to allow remote Mainframe programs to execute
     a target Web Service operations.
     Prerequisite: COBOL binding classes should have been generated
     using Coxbgen prior to using this script.
     Refer to http://www.legsem.com/legstar for info on generating binding classes.
  -->
<project basedir=".." default="generateCixs2Jaxws" name="generate-cixs2jaxws">

    <!-- ===========================================================  -->
    <!-- Setup environment
    -->
    <target name="init">
    
        <property environment="env"/>
        <!-- Service name   -->
        <property name="service" value="cultureinfo" />
        <!-- Service URI where generated proxy will be listening for Mainframe calls   -->
        <property name="serviceURI" value="http://localhost:8080/c2ws-${service}/${service}Proxy" />
        
        <!-- Target Web Service WSDL URL   -->
        <property name="wsdl.url" value="http://localhost:8080/jaxws-cultureinfo/getinfo?wsdl"/>
        <!-- Target Web Service WSDL service name   -->
        <property name="wsdl.service.name" value="CultureInfoImplService"/>
        <!-- Target Web Service WSDL port name   -->
        <property name="wsdl.port.name" value="CultureInfoImplPort"/>
        <!-- Target Web Service target namespace   -->
        <property name="target.namespace" value="http://cultureinfo.cases.test.xsdc.legstar.com/"/>
        
        
        <!-- The input JAXB type name   -->
        <property name="jaxb.root.name.in" value="GetInfo" />
        <!-- The input JAXB package name  -->
        <property name="jaxb.package.name.in" value="com.legstar.test.coxb.cultureinfo"/>
        <!-- The output JAXB type name   -->
        <property name="jaxb.root.name.out" value="GetInfoResponse" />
        <!-- The output JAXB package name  -->
        <property name="jaxb.package.name.out" value="com.legstar.test.coxb.cultureinfo"/>
        
        <!-- Location of JAXB classes   -->
        <property name="jaxb.bin.dir" value="${basedir}/target/classes"/>
        <!-- Location of COXB binding classes   -->
        <property name="coxb.bin.dir" value="${basedir}/target/classes"/>
        <!-- Location of custom code classes   -->
        <property name="cust.bin.dir" value="${basedir}/target/classes"/>
    
        <!-- Generated Ant scripts target location   -->
        <property name="ant.dir" value="${basedir}/src/main/ant/${service}"/>
        <!-- Generated Web descriptors target location   -->
        <property name="wdd.dir" value="${basedir}/src/main/WebContent/${service}/WEB-INF"/>
        <!-- Generated COBOL CICS program target location   -->
        <property name="cobol.dir" value="${basedir}/src/main/cobol"/>
        <!-- Generated sample COBOL CICS program name   -->
        <property name="cics.program.name" value="CULTUREI" />
        <!-- War files target location   -->
        <condition property="war.dir" value="${env.CATALINA_BASE}/webapps" else="${env.CATALINA_HOME}/webapps">
            <isset property="env.CATALINA_BASE"/> 
        </condition>
    
        <!-- Mainframe character set   -->
        <property name="host.charset" value="IBM01140" />

        <!-- Classpath setting -->
        <path id="classpath">
            <pathelement location="${jaxb.bin.dir}"/>
            <pathelement location="${coxb.bin.dir}"/>
            <pathelement location="${cust.bin.dir}"/>
            <fileset dir="${basedir}" includes="lib/*.jar" />
        </path>
        
        <!-- Mainframe Proxy Generator ant task -->
        <taskdef name="cixs2jaxwsgen"
            classname="com.legstar.cixs.jaxws.gen.Cixs2JaxwsGenerator"
            classpathref="classpath" 
        /> 
    
    </target>

    <!-- ===========================================================  -->
    <!-- This step creates all the artifacts for a service.  -->
    
    <target name="generateCixs2Jaxws" depends="init">
    
        <cixs2jaxwsgen
            targetAntDir="${ant.dir}"
            targetWDDDir="${wdd.dir}"
            targetWarDir="${war.dir}"
            targetCobolDir="${cobol.dir}"
            jaxbBinDir="${jaxb.bin.dir}"
            coxbBinDir="${coxb.bin.dir}"
            custBinDir="${cust.bin.dir}"
            hostCharset="${host.charset}"
        >
            <cixsJaxwsService name="${service}"
                wsdlUrl="${wsdl.url}"
                wsdlPortName="${wsdl.port.name}"
                wsdlServiceName="${wsdl.service.name}"
                targetNamespace="${target.namespace}"
                serviceURI="${serviceURI}"
            >
                <cixsOperation name="${service}"
                    cicsProgramName="${cics.program.name}"
                >
                    <input
                        jaxbType="${jaxb.root.name.in}"
                        jaxbPackageName="${jaxb.package.name.in}"
                    />
                    <output
                        jaxbType="${jaxb.root.name.out}"
                        jaxbPackageName="${jaxb.package.name.out}"
                    />
                </cixsOperation>
            </cixsJaxwsService>
        </cixs2jaxwsgen>
    
    </target>
   
</project>