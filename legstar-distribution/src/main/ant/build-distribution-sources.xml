<!-- =================================================================================
     This script creates a single jar file with all Legstar sources.
 -->
<project basedir="../../.." default="buildDistribution" name="build-distribution">

	<!-- ===========================================================  -->
	<!-- Setup environment
	  -->
	<target name="init">
		
		<!-- Temporary build location  -->
	 	<property name="temp.dir" value="${basedir}/target/work" />
		<!-- Sources jar files relative location  -->
	 	<property name="srce.loc" value="target" />
		<!-- Distribution file relative location  -->
	 	<property name="dist.loc" value="src/site/resources/binaries" />
		<!-- Distribution file absolute location  -->
	 	<property name="dist.dir" value="${basedir}/../${dist.loc}" />

		<!-- LegStar sources distribution properties  -->
	 	<property name="legstar.loc" value="legstar" />
	 	<property name="legstar.ver" value="0.0.1" />
	 	<property name="legstar.fol" value="${legstar.loc}-${legstar.ver}-sources" />
	 	<property name="legstar.jar" value="${srce.loc}/${legstar.fol}.jar" />

		<!-- Schemagen sources distribution properties  -->
	 	<property name="schemagen.loc" value="legstar-schemagen" />
	 	<property name="schemagen.ver" value="0.0.1" />
	 	<property name="schemagen.fol" value="${schemagen.loc}-${schemagen.ver}-sources" />
	 	<property name="schemagen.jar" value="../${schemagen.loc}/${srce.loc}/${schemagen.fol}.jar" />
		
		<!-- Coxbrt sources distribution properties  -->
	 	<property name="coxbrt.loc" value="legstar-coxbrt" />
	 	<property name="coxbrt.ver" value="0.0.1" />
	 	<property name="coxbrt.fol" value="${coxbrt.loc}-${coxbrt.ver}-sources" />
	 	<property name="coxbrt.jar" value="../${coxbrt.loc}/${srce.loc}/${coxbrt.fol}.jar" />

		<!-- Coxbgen sources distribution properties  -->
	 	<property name="coxbgen.loc" value="legstar-coxbgen" />
	 	<property name="coxbgen.ver" value="0.0.1" />
	 	<property name="coxbgen.fol" value="${coxbgen.loc}-${coxbgen.ver}-sources" />
	 	<property name="coxbgen.jar" value="../${coxbgen.loc}/${srce.loc}/${coxbgen.fol}.jar" />

		<!-- Common sources distribution properties  -->
	 	<property name="common.loc" value="legstar-common" />
	 	<property name="common.ver" value="0.0.1" />
	 	<property name="common.fol" value="${common.loc}-${common.ver}-sources" />
	 	<property name="common.jar" value="../${common.loc}/${srce.loc}/${common.fol}.jar" />

		<!-- Cixsrt sources distribution properties  -->
	 	<property name="cixsrt.loc" value="legstar-cixsrt" />
	 	<property name="cixsrt.ver" value="0.0.1" />
	 	<property name="cixsrt.fol" value="${cixsrt.loc}-${cixsrt.ver}-sources" />
	 	<property name="cixsrt.jar" value="../${cixsrt.loc}/${srce.loc}/${cixsrt.fol}.jar" />

		<!-- Cixsgen sources distribution properties  -->
	 	<property name="cixsgen.loc" value="legstar-cixsgen" />
	 	<property name="cixsgen.ver" value="0.0.1" />
	 	<property name="cixsgen.fol" value="${cixsgen.loc}-${cixsgen.ver}-sources" />
	 	<property name="cixsgen.jar" value="../${cixsgen.loc}/${srce.loc}/${cixsgen.fol}.jar" />

	</target>

	<!-- ===========================================================  -->
	<!-- Build the main sources distribution
	  -->
	<target name="buildDistribution" depends="init">
		
		<delete dir="${temp.dir}" includeEmptyDirs="true" quiet="true"/>
		<mkdir dir="${temp.dir}"/> 
		
		<!-- Include Schemagen  -->
		<unzip src="${basedir}/${schemagen.jar}" dest="${temp.dir}"/>

		<!-- Include Common  -->
		<unzip src="${basedir}/${common.jar}" dest="${temp.dir}"/>

		<!-- Include Coxbrt  -->
		<unzip src="${basedir}/${coxbrt.jar}" dest="${temp.dir}"/>

		<!-- Include Coxbgen  -->
		<unzip src="${basedir}/${coxbgen.jar}" dest="${temp.dir}"/>

		<!-- Include Cixsrt  -->
		<unzip src="${basedir}/${cixsrt.jar}" dest="${temp.dir}"/>

		<!-- Include Cixsgen  -->
		<unzip src="${basedir}/${cixsgen.jar}" dest="${temp.dir}"/>

		<!-- Create legstar source distribution  -->
		<delete file="${legstar.jar}" quiet="true"/>
		<jar destfile="${legstar.jar}"
		       basedir="${temp.dir}"
			   includes="**"
		/>		

		<!-- Copy the distribution into the legstar central location  -->
		<copy todir="${dist.dir}" file="${legstar.jar}"/>
		
		<!-- Cleanup  -->
		<delete dir="${temp.dir}" includeEmptyDirs="true" quiet="true"/>

	</target>
	
</project>
