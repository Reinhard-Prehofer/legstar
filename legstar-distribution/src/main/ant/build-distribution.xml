<!-- =================================================================================
     This script creates the common distribution for all LegStar modules.
e -->
<project basedir="../../.." default="buildDistribution" name="build-distribution">

	<!-- ===========================================================  -->
	<!-- Setup environment
	     Caller must set a property version
	  -->
	<target name="init">
		
		<!-- Temporary build location  -->
	 	<property name="temp.dir" value="${basedir}/target/work" />
		<!-- Distribution file relative location  -->
	 	<property name="dist.loc" value="src/site/resources/binaries" />
		<!-- Distribution file absolute location  -->
	 	<property name="dist.dir" value="${basedir}/${dist.loc}" />

		<!-- LegStar distribution properties  -->
	 	<property name="legstar.loc" value="legstar" />
	 	<property name="legstar.ver" value="${version}" />
	 	<property name="legstar.fol" value="${legstar.loc}-${legstar.ver}" />
	 	<property name="legstar.zip" value="${dist.dir}/${legstar.fol}-win32.zip" />

		<!-- Schemagen distribution properties  -->
	 	<property name="schemagen.loc" value="legstar-schemagen" />
	 	<property name="schemagen.ver" value="${version}" />
	 	<property name="schemagen.fol" value="${schemagen.loc}-${schemagen.ver}" />
	 	<property name="schemagen.zip" value="../${schemagen.loc}/${dist.loc}/${schemagen.fol}-win32.zip" />
		
		<!-- Coxbgen distribution properties  -->
	 	<property name="coxbgen.loc" value="legstar-coxbgen" />
	 	<property name="coxbgen.ver" value="${version}" />
	 	<property name="coxbgen.fol" value="${coxbgen.loc}-${coxbgen.ver}" />
	 	<property name="coxbgen.zip" value="../${coxbgen.loc}/${dist.loc}/${coxbgen.fol}-bin.zip" />

		<!-- Cixsgen distribution properties  -->
	 	<property name="cixsgen.loc" value="legstar-cixsgen" />
	 	<property name="cixsgen.ver" value="${version}" />
	 	<property name="cixsgen.fol" value="${cixsgen.loc}-${cixsgen.ver}" />
	 	<property name="cixsgen.zip" value="../${cixsgen.loc}/${dist.loc}/${cixsgen.fol}-bin.zip" />

		<!-- Messaging  distribution properties  -->
	 	<property name="messaging.loc" value="legstar-messaging" />
	 	<property name="messaging.ver" value="${version}" />
	 	<property name="messaging.fol" value="${messaging.loc}-${messaging.ver}" />
	 	<property name="messaging.zip" value="../${messaging.loc}/${dist.loc}/${messaging.fol}-bin.zip" />
		
		<!-- Invoker distribution properties  -->
	 	<property name="invoker.loc" value="legstar-invoker" />
	 	<property name="invoker.ver" value="${version}" />
	 	<property name="invoker.fol" value="${invoker.loc}-${invoker.ver}" />
	 	<property name="invoker.zip" value="../${invoker.loc}/${dist.loc}/${invoker.fol}-bin.zip" />
		
		<!-- Engine distribution properties  -->
	 	<property name="engine.loc" value="legstar-engine" />
	 	<property name="engine.ver" value="${version}" />
	 	<property name="engine.fol" value="${engine.loc}-${engine.ver}" />
	 	<property name="engine.zip" value="../${engine.loc}/${dist.loc}/${engine.fol}-bin.zip" />
		
		<!-- Chttprt distribution properties  -->
	 	<property name="chttprt.loc" value="legstar-chttprt" />
	 	<property name="chttprt.ver" value="${version}" />
	 	<property name="chttprt.fol" value="${chttprt.loc}-${chttprt.ver}" />
	 	<property name="chttprt.zip" value="../${chttprt.loc}/${dist.loc}/${chttprt.fol}-bin.zip" />

		<!-- Csokrt distribution properties  -->
	 	<property name="csokrt.loc" value="legstar-csokrt" />
	 	<property name="csokrt.ver" value="${version}" />
	 	<property name="csokrt.fol" value="${csokrt.loc}-${csokrt.ver}" />
	 	<property name="csokrt.zip" value="../${csokrt.loc}/${dist.loc}/${csokrt.fol}-bin.zip" />
		
	</target>

	<!-- ===========================================================  -->
	<!-- Build the main distribution
	  -->
	<target name="buildDistribution" depends="init">
		
		<delete dir="${temp.dir}" includeEmptyDirs="true" quiet="true"/>
		<mkdir dir="${temp.dir}/${legstar.fol}"/> 
		
		<!-- Include Schemagen  -->
		<unzip src="${basedir}/${schemagen.zip}" dest="${temp.dir}"/>
		<move file="${temp.dir}/${schemagen.fol}/README" tofile="${temp.dir}/${schemagen.fol}/README-SCHEMAGEN"/>
		<move file="${temp.dir}/${schemagen.fol}/NOTICE" tofile="${temp.dir}/${schemagen.fol}/NOTICE-SCHEMAGEN"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${schemagen.fol}"/>
		</copy>

		<!-- Include Coxbgen  -->
		<unzip src="${basedir}/${coxbgen.zip}" dest="${temp.dir}"/>
		<move file="${temp.dir}/${coxbgen.fol}/README" tofile="${temp.dir}/${coxbgen.fol}/README-COXBGEN"/>
		<move file="${temp.dir}/${coxbgen.fol}/NOTICE" tofile="${temp.dir}/${coxbgen.fol}/NOTICE-COXBGEN"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${coxbgen.fol}"/>
		</copy>

		<!-- Include Cixsgen  -->
		<unzip src="${basedir}/${cixsgen.zip}" dest="${temp.dir}"/>
		<move file="${temp.dir}/${cixsgen.fol}/README" tofile="${temp.dir}/${cixsgen.fol}/README-CIXSGEN"/>
		<move file="${temp.dir}/${cixsgen.fol}/NOTICE" tofile="${temp.dir}/${cixsgen.fol}/NOTICE-CIXSGEN"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${cixsgen.fol}"/>
		</copy>

		<!-- Include Messaging  -->
		<unzip src="${basedir}/${messaging.zip}" dest="${temp.dir}"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${messaging.fol}"/>
		</copy>

		<!-- Include Invoker  -->
		<unzip src="${basedir}/${invoker.zip}" dest="${temp.dir}"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${invoker.fol}"/>
		</copy>

		<!-- Include Engine  -->
		<unzip src="${basedir}/${engine.zip}" dest="${temp.dir}"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${engine.fol}"/>
		</copy>
		
		<!-- Include Chttprt  -->
		<unzip src="${basedir}/${chttprt.zip}" dest="${temp.dir}"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${chttprt.fol}"/>
		</copy>
		
		<!-- Include Csokrt  -->
		<unzip src="${basedir}/${csokrt.zip}" dest="${temp.dir}"/>
		<copy todir="${temp.dir}/${legstar.fol}">
			<fileset dir="${temp.dir}/${csokrt.fol}"/>
		</copy>
		
		<!-- Create legstar distribution  -->
		<delete file="${legstar.zip}" quiet="true"/>
		<zip destfile="${legstar.zip}"
		       basedir="${temp.dir}"
			   includes="${legstar.fol}/**"
		/>		

		<!-- Cleanup  -->
		<delete dir="${temp.dir}" includeEmptyDirs="true" quiet="true"/>
	</target>
	
</project>
