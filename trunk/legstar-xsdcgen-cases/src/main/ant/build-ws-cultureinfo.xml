<?xml version="1.0" encoding="UTF-8"?>
<!-- =================================================================================
     This script generates the a web service from a POJO using Sun's Apt utility.
     It is important that JAVA_HOME points to an SDK.
     The generated classes along with XML descriptors are bundled in a war file ready
     to be deployed to a J2EE server.
 -->
<project basedir="../../.." default="deploy-war" name="wsgen">

    <target name="setup">
        <property environment="env"/>
    	<!-- Tomcat destination  -->
     	<property name="tomcat.lib" value="${tomcat.base}\shared\lib" />
     	<property name="tomcat.webapps" value="${tomcat.base}\webapps" />

        <property name="verbose" value="false"/>
        <property name="build.home" value="${basedir}/target"/>
        <property name="build.war.home" value="${build.home}/war"/>
        <property name="build.classes.home" value="${build.home}/gen-classes"/>
        
        <path id="jaxws.classpath">
            <pathelement location="${env.JAVA_HOME}/lib/tools.jar"/>
            <path refid="maven.classpath"/>
        </path>

        <taskdef name="apt" classname="com.sun.tools.ws.ant.Apt">
            <classpath refid="jaxws.classpath"/>
        </taskdef>

        <mkdir dir="${build.home}"/>
        <mkdir dir="${build.classes.home}"/>
        <mkdir dir="${build.war.home}"/>
    </target>

    <target name="build-server-java" depends="setup">
        <apt
            target="1.5"
        	fork="true"
            verbose="${verbose}"
            destdir="${build.classes.home}"
            sourcedestdir="${basedir}/src/gen/java"
            sourcepath="${basedir}/src/main/java">
            <classpath>
                <path refid="jaxws.classpath"/>
            </classpath>
            <option key="r" value="${build.home}"/>
            <source dir="${basedir}/src/main/java">
                <include name="**/cultureinfo/*.java"/>
            </source>
        </apt>
    </target>
	
    <target name="create-war" depends="build-server-java">
        <war warfile="${build.war.home}/jaxws-cultureinfo.war" webxml="${basedir}/src/main/webapp/WEB-INF/cultureinfo/web.xml">
            <webinf dir="${basedir}/src/main/webapp/WEB-INF/cultureinfo" includes="sun-jaxws.xml"/>
            <classes dir="${build.classes.home}"/>
        </war>
    </target>

    <target name="deploy-war" depends="create-war">
        <delete file="${tomcat.webapps}/jaxws-cultureinfo.war" includeEmptyDirs="true"
                quiet="true"/>
		<copy todir="${tomcat.webapps}">
			<fileset dir="${build.war.home}" includes="*.war"/>
		</copy>
    </target>

</project>
