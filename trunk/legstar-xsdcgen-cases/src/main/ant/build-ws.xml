<?xml version="1.0" encoding="UTF-8"?>
<!-- =================================================================================
     This script generates the a web service from a POJO using Sun's JAXWS apt utility.
     The generated classes along with XML descriptors are bundled in a war file ready
     to be deployed to a J2EE server.
     This ant task expects a wsname parameter that serves as the Web Service name.
     It is assumed the source POJO classes belong to a package where ${wsname} appears
     as a package level. Classes must be present in ${basedir}/target.
 -->
<project basedir="../../.." default="server" name="wsgen">

    <property environment="env"/>
    <property file="../legstar-pom/legstar-dev.properties"/>   

    <property name="verbose" value="true"/>
    <property name="jaxws.lib" value="${env.JAXWS_HOME}/lib"/>
    <property name="build.home" value="${basedir}/target"/>
    <property name="build.war.home" value="${build.home}/war"/>
    <property name="build.classes.home" value="${build.home}/gen-classes"/>
    
    <path id="jaxws.classpath">
        <pathelement location="${jdk.home}/lib/tools.jar"/>
        <fileset dir="${jaxws.lib}">
            <include name="*.jar"/>
            <exclude name="j2ee.jar"/>
        </fileset>
    </path>

    <taskdef name="apt" classname="com.sun.tools.ws.ant.Apt">
        <classpath refid="jaxws.classpath"/>
    </taskdef>

    <target name="setup">
        <mkdir dir="${build.home}"/>
        <mkdir dir="${build.classes.home}"/>
        <mkdir dir="${build.war.home}"/>
    </target>

    <target name="build-server-java">
        <apt
            fork="true"
            verbose="${verbose}"
            destdir="${build.classes.home}"
            sourcedestdir="${basedir}/src/gen/java"
            sourcepath="${basedir}/src/main/java">
            <classpath>
                <path refid="jaxws.classpath"/>
            </classpath>
            <option key="r" value="${build.home}"/>
            <source dir="${basedir}/src/main/java">
                <include name="**/${wsname}/*.java"/>
            </source>
        </apt>
    </target>

    <target name="create-war">
        <war warfile="${build.war.home}/jaxws-${wsname}.war" webxml="${basedir}/src/main/webapp/WEB-INF/${wsname}/web.xml">
            <webinf dir="${basedir}/src/main/webapp/WEB-INF/${wsname}" includes="sun-jaxws.xml"/>
            <classes dir="${build.classes.home}"/>
        </war>
    </target>

    <target name="server" depends="setup">
        <antcall target="build-server-java"/>
        <antcall target="create-war"/>
    </target>

</project>
