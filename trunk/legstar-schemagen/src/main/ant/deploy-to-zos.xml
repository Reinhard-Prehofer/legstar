<!-- =================================================================================
     This script deploys sources and jcl to zos.
 -->
<project basedir="../../.." default="deployToZos" name="deploy-to-zos">

    <!-- ===========================================================  -->
    <!-- Setup environment
    -->
    <property file="../legstar-dev.properties"/>   

    <!-- Import the ZOS version builder script... -->
    <import file="${basedir}/../src/main/ant/prepare-zos-version.xml"/>

    <!-- ===========================================================  -->
    <!-- Upload sources and JCL to distribution PDS
       Because extensions are not supported by MVS, we first copy
       files removing extensions to a temporary location
    -->

    <target name="deployToZos" depends="prepareZosVersion">
    
        <!-- Generate the MANIFEST with the correct version and dependency versions -->
        <echo message="Uploading on z/OS for version=${legstarZosVersion}"/>

        <!-- cobol source files -->
        <copy todir="target/zos/COBOL">
            <fileset dir="${basedir}/src/main/zos/cobol"/>
            <globmapper from="*.cbl" to="*"/>
        </copy>
    
        <ftp server="${legstarZosHost}"
                remotedir="LEGSTAR.${legstarZosVersion}.COBOL"
                userid="${legstarZosUserid}"
                password="${legstarZosPassword}"
                binary="no">
            <fileset dir="target/zos/COBOL"/>
        </ftp>

        <!-- Compilation jcl -->
        <copy todir="target/zos/CNTL">
            <fileset dir="${basedir}/src/main/zos/JCL"/>
            <filterset>
                <filter token="VERSION" value="${legstarZosVersion}"/>
            </filterset>
        </copy>

        <ftp server="${legstarZosHost}"
                remotedir="LEGSTAR.${legstarZosVersion}.CNTL"
                userid="${legstarZosUserid}"
                password="${legstarZosPassword}"
                binary="no">
            <fileset dir="target/zos/CNTL"/>
        </ftp>

  </target>
  
</project>
