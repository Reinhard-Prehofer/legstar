<!-- =================================================================================
     This script tests the distribution file. It unzips the distro to a temporary
     location and runs the quickstarts.
 -->
<project basedir="../../.." default="testDistro" name="build-sample">

    <!-- ===========================================================  -->
    <!-- Setup environment
    -->
    <target name="init">
        <xmlproperty file="${basedir}/pom.xml"/>
        
        <property environment="env"/>
        <!-- Temporary location  -->
        <property name="test.dir" value="target/test-distro" />
        <!-- Distribution name  -->
        <property name="dist.name" value="${project.artifactId}-${project.version}" />
        <!-- Distribution zip file  -->
        <property name="dist.zip" value="${dist.name}-bin.zip" />
        <!-- Distribution file location   -->
        <property name="dist.dir" value="${basedir}/target" />
        <!-- Distribution zip file   -->
        <property name="zip.file" value="${dist.dir}/${dist.zip}" />
        <!-- Distribution sample location   -->
        <property name="sample.dir" value="${test.dir}/${dist.name}/samples/quickstarts/adapter_lsfileae" />
    
    </target>
    
    <!-- ===========================================================  -->
    <!-- Build the sample and check that a schema was generated
        Submitting ant via OS command is necessary because native DLLs
        are already loaded by maven so we cannot use ant ant task.
        FIXME: This is OS specific
    -->
    <target name="testDistro" depends="init">

        <unzip src="${zip.file}" dest="${test.dir}"/>
        <echo message=">>>> ${test.dir}/${dist.name}/bin;${env.Path};${env.PATH}"/>
        <exec executable="cmd">
            <env key="Path" value="${test.dir}/${dist.name}/bin;${env.Path}"/>
            <arg value="/c"/>
            <arg value="ant.bat"/>
            <arg value="-f"/>
            <arg value="${sample.dir}/build-cob2xs.xml"/>
        </exec>
        <loadfile property="message" srcFile="${sample.dir}/schema/lsfileae.xsd"/>
        <echo message="${message}"/>
    
    </target>
  
</project>
