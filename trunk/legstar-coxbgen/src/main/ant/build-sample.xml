<!-- =================================================================================
     This script builds the sample that is delivered with the assemblies.
 -->
<project basedir="../../.." default="buildSample" name="build-sample">

	<!-- ===========================================================  -->
	<!-- Setup environment
	  -->
	<target name="init">
        <xmlproperty file="${basedir}/pom.xml"/>
		
		<!-- Source XML schema location  -->
	 	<property name="schema.dir" value="${basedir}/../legstar-schemagen/src/test/schema" />
		<!-- Sample project location  -->
	 	<property name="sample.project" value="${basedir}/../legstar-samples" />
		<!-- Distribution name  -->
        <property name="dist.name" value="${project.artifactId}-${project.version}" />
		<!-- Distribution zip file  -->
	 	<property name="dist.zip" value="${dist.name}-bin.zip" />
		<!-- Distribution file location   -->
	 	<property name="dist.dir" value="${basedir}/target" />
		<!-- Distribution zip file   -->
	 	<property name="zip.file" value="${dist.dir}/${dist.zip}" />
		<!-- Sample final destination for sources  -->
	 	<property name="sample.src" value="${sample.project}/src" />
		<!-- Sample final destination for binaries  -->
	 	<property name="sample.bin" value="${sample.project}/target" />
        <!-- Whether to fork the java compiler or not   -->
        <property name="javac.fork" value="yes" />
		
	</target>

	<!-- ===========================================================  -->
	<!-- Build the sample
	  -->
	<target name="buildSample" depends="init">
		<mkdir dir="${sample.src}"/> 
		<mkdir dir="${sample.bin}"/> 
		<unzip src="${zip.file}" dest="${sample.project}"/>

        <!-- The standard build-jaxb and build-coxb deal with the lsfileae
             sample. -->      
		<ant antfile="${sample.project}/${dist.name}/ant/build-jaxb.xml"
			 dir="${sample.project}/${dist.name}"/>
		<ant antfile="${sample.project}/${dist.name}/ant/build-coxb.xml"
			 dir="${sample.project}/${dist.name}"/>

        <!-- These will process the cultureinfo sample. -->      
        <ant antfile="${sample.project}/${dist.name}/ant/build-jaxb.xml"
             dir="${sample.project}/${dist.name}">
            <property name="xsd.file" value="${schema.dir}/cultureinfo.xsd"/>   
        </ant>
        <ant antfile="${sample.project}/${dist.name}/ant/build-coxb.xml"
             dir="${sample.project}/${dist.name}">
            <property name="xsd.file" value="${schema.dir}/cultureinfo.xsd"/>   
            <property name="jaxb.root.name" value="GetInfo" />
        </ant>
        <ant antfile="${sample.project}/${dist.name}/ant/build-coxb.xml"
             dir="${sample.project}/${dist.name}">
            <property name="xsd.file" value="${schema.dir}/cultureinfo.xsd"/>   
            <property name="jaxb.root.name" value="GetInfoResponse" />
        </ant>
        
		<copy todir="${sample.src}">
			<fileset dir="${sample.project}/${dist.name}/src"/>
		</copy>
		<copy todir="${sample.bin}">
			<fileset dir="${sample.project}/${dist.name}/target"/>
		</copy>
        <delete dir="${sample.project}/${dist.name}" includeEmptyDirs="true" quiet="true"/>
	</target>
	
</project>
